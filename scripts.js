!function(a){function b(a,b,c){var d=a[b];a[b]=function(){var a=this.__super;this.__super=d,c.apply(this,arguments),this.__super=a}}function c(a,c){return function(d){_.isObject(a)&&_.each(a,function(a,c){d.hasOwnProperty(c)?b(d,c,a):d[c]=a}),_.isObject(c)&&Object.defineProperties(d,c)}}a.override=b,a.Mixin=c}(this),function(a){function b(a,b){Phaser.Group.call(this,a),this.team=b}_.extend(b,{PLAYER:0,ENEMY:1}),b.prototype=Object.create(Phaser.Group.prototype),b.prototype.constructor=b,Object.defineProperty(b.prototype,"",{get:function(){}}),a.Team=b}(this),function(a){function b(a){Phaser.Sprite.call(this,a,0,0,"health-bar"),this._value=100,this._max=100,this._rect=new Phaser.Rectangle(0,0,this.width,this.height),this.crop(this._rect);var b=a.make.sprite(0,0,"health-bar-overlay");this.addChild(b),this._updateGraphics()}_.extend(b,{preload:function(a){a.image("health-bar","assets/health bar.a79e305f.png"),a.image("health-bar-overlay","assets/health bar overlay.3e0f91a8.png")}}),b.prototype=Object.create(Phaser.Sprite.prototype),b.prototype.constructor=b,_.extend(b.prototype,{setTo:function(a,b){void 0!==b&&(this.max=b),this.value=a},subtract:function(a){this.value=this.value-a},_updateGraphics:function(){var a=this.value,b=this.max,c=a/b;this.visible=b>a,this._rect.width=this.width*c}}),Object.defineProperties(b.prototype,{value:{get:function(){return this._value},set:function(a){return a=Math.min(a,this.max),a=Math.max(a,0),this._value=a,this._updateGraphics(),this._value}},max:{get:function(){return this._max},set:function(a){a=Math.max(a,0),this._max=a,this.value>this._max&&(this.value=a),this._updateGraphics()}}}),a.HealthBar=b}(this),function(a){var b=Mixin({initialize:function(){var a=this.hp=new HealthBar(this.game);this.addChild(a)},getNearestInFront:function(a){var b=[];this.foes.forEachExists(b.push,b);var c=_(b).filter(function(a){return this.team===Team.PLAYER&&a.front>this.front||this.team!==Team.PLAYER&&a.front<this.front},this).map(function(a){return{unit:a,dist:Math.abs(a.front-this.front)}},this).sortBy("dist").first(a||1).valueOf();return _.isEmpty(c)&&c.push({unit:void 0,dist:1/0}),void 0===a?c[0]:c}},{friends:{get:function(){var a=this.game.team;return this.team===Team.PLAYER?a.player:a.enemy}},foes:{get:function(){var a=this.game.team;return this.team===Team.PLAYER?a.enemy:a.player}},front:{get:function(){var a=Math.abs(this._front||this.width/2);return this.team===Team.PLAYER?this.x+a:this.x-a},set:function(a){this._front=a}}});a.UnitMixin=b}(this),function(a){function b(a,b,c,d){var e=d==Team.PLAYER?"placeholder-tank.png":"placeholder-enemy-tank.png";Phaser.Sprite.call(this,a,b,c,e),this.initialize(),this.anchor.setTo(.5,0),this.animations.add("idle",[2]),this.animations.add("walk",[0,1],5,!0),this.animations.play("idle"),a.physics.enable(this,Phaser.Physics.ARCADE),this.team=d,this.facing=d===Team.PLAYER?Phaser.RIGHT:Phaser.LEFT,this.hp.x=-32,this.hp.y=-32,e=d==Team.PLAYER?"placeholder-player-sword":"placeholder-enemy-sword";var f=this.sword=a.make.sprite(0,50,e);this.addChild(f),f.anchor.setTo(.5,1),f.visible=!1,this._zone=new Phaser.Rectangle,this.walk()}_.extend(b,{Walk:{Speed:100},Attack:{Range:50,Angle:135,Duration:600,Easing:Phaser.Easing.Quartic.Out,DamageDelay:100,Damage:40,Zone:{X:120,Y:25,Width:120,Height:100},Cooldown:.5},preload:function(a){a.spritesheet("placeholder-tank.png","assets/placeholder tank.ab6841ab.png",78,150),a.spritesheet("placeholder-enemy-tank.png","assets/placeholder enemy tank.dd9a4f5f.png",78,150),a.image("placeholder-player-sword","assets/placeholder sword.b8d5ad23.png"),a.image("placeholder-enemy-sword","assets/placeholder enemy sword.eb8b2d73.png")}}),b.prototype=Object.create(Phaser.Sprite.prototype),b.prototype.constructor=b,UnitMixin(b.prototype),_.extend(b.prototype,{think:function(){var a=this.getNearestInFront();switch(this.state){case"walking":a.dist<=b.Attack.Range&&(this.stop(),this.attack(a.unit));break;case"standing":a.dist<=b.Attack.Range?this.attack(a.unit):this.walk();break;case"cooling down":this.cooldownTimer-=this.game.time.physicsElapsed,this.cooldownTimer<=0&&this.stand()}},stop:function(){switch(this.state){case"walking":this.body.velocity.x=0,this.animations.play("idle"),this.state="idle";break;case"attacking":this.cleanUpAttack(),this.state="idle"}},walk:function(){this.animations.play("walk"),this.body.velocity.x=this.facing===Phaser.RIGHT?b.Walk.Speed:-b.Walk.Speed,this.state="walking"},stand:function(){this.state="standing",this.body.velocity.x=0,this.animations.play("idle")},attack:function(){this.state="attacking";var a=this.game,c=this.sword,d=this.sword.tween=a.add.tween(c),e=this.team==Team.PLAYER?b.Attack.Angle:-b.Attack.Angle;c.visible=!0,c.bringToTop(),c.angle=0,d.to({angle:e},b.Attack.Duration,b.Attack.Easing,!0).onComplete.addOnce(this.attackCooldown,this),a.time.events.add(b.Attack.DamageDelay,function(){var a=this.damageZone;this.foes.forEachExists(function(c){a.intersects(c.body)&&c.damage(b.Attack.Damage)},this)},this)},attackCooldown:function(){this.cleanUpAttack(),this.state="cooling down",this.cooldownTimer=b.Attack.Cooldown},cleanUpAttack:function(){var a=this.sword;a.visible=!1,a.tween&&(a.tween.isRunning&&a.tween.stop(),a.tween=void 0)},damage:function(a){this.hp.subtract(a)}}),Object.defineProperty(b.prototype,"damageZone",{get:function(){var a=b.Attack.Zone.Width,c=(b.Attack.Zone.Height,this.x+(this.team===Team.PLAYER?b.Attack.Zone.X-a:-b.Attack.Zone.X)),d=this.y+b.Attack.Zone.Y;return this._zone.setTo(c,d,b.Attack.Zone.Width,b.Attack.Zone.Height),this._zone}}),a.Tank=b}(this),function(a){function b(){}b.prototype={preload:function(){this.load.image("loading-bar","assets/loading bar.f44b1a70.png"),this.load.image("loading-bar-bg","assets/loading bar bg.1fe86dc8.png")},create:function(){this.state.start("preload")}},a.Boot=b}(this),function(a){function b(){}b.prototype={preload:function(){var a=250,b=296,c=this.add,d=this.load;c.sprite(a,b,"loading-bar-bg");var e=c.sprite(a,b,"loading-bar");d.setPreloadSprite(e),d.bitmapFont("minecraftia","assets/minecraftia.d0c5b06a.png","assets/minecraftia.22ff6d4c.xml"),d.image("horizon-line","assets/placeholder horizon.97f9ad70.png"),HealthBar.preload(d),Tank.preload(d),d.onLoadComplete.addOnce(this.onLoadComplete,this)},create:function(){this.stage.backgroundColor="#000000"},onLoadComplete:function(){this.state.start("game")}},a.Preload=b}(this),function(a){function b(){}b.prototype={create:function(){var a=this.game,b=this.add;a.stage.backgroundColor="#FFFFFF",b.tileSprite(0,450,1e3,32,"horizon-line",0),a.team={player:b.existing(new Team(a,Team.PLAYER)),enemy:b.existing(new Team(a,Team.ENEMY))},a.team.player.add(new Tank(a,100,400,Team.PLAYER)),a.team.enemy.add(new Tank(a,680,400,Team.ENEMY))},update:function(){game.team.player.callAll("think"),game.team.enemy.callAll("think")},render:function(){}},a.Game=b}(this);var game=new Phaser.Game(800,600,Phaser.AUTO,"game-container");game.state.add("boot",Boot),game.state.add("preload",Preload),game.state.add("game",Game),game.state.start("boot");